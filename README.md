# üöÄ API de Transfer√™ncias e Usu√°rios

> Projeto desenvolvido como **Desafio #3 da Mentoria em Testes de Software**, orientado por [J√∫lio de Lima](https://github.com/juliodelimas/pgats-02-api).

![Node.js 18.x](https://img.shields.io/badge/node.js-18.x-green?logo=node.js)
![Mocha](https://img.shields.io/badge/Mocha-Testing-red?logo=mocha)
![SuperTest](https://img.shields.io/badge/SuperTest-API%20Testing-orange)
![k6](https://img.shields.io/badge/k6-Performance-blueviolet?logo=k6)

---

## üìò Sum√°rio

- [Sobre o Projeto](#-sobre-o-projeto)
- [Tecnologias Utilizadas](#-tecnologias-utilizadas)
- [Como Executar](#-como-executar)
- [Como Rodar os Testes](#-como-rodar-os-testes)
- [Heur√≠stica VADER](#-heur√≠stica-vader)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [Regras de Neg√≥cio](#-regras-de-neg√≥cio)
- [Testes de Performance](#-testes-de-performance)
- [Resultados dos Testes](#-resultados-dos-testes)
- [Relat√≥rios e Evid√™ncias](#-relat√≥rios-e-evid√™ncias)
- [M√©tricas de Cobertura e Performance](#-m√©tricas-de-cobertura-e-performance)
- [Cr√©ditos e Licen√ßa](#-cr√©ditos-e-licen√ßa)

---

## üß© Sobre o Projeto

Este reposit√≥rio √© um **fork** do projeto original de [J√∫lio de Lima](https://github.com/juliodelimas/pgats-02-api), criado para **praticar automa√ß√£o de testes de API REST e testes de performance**.

O desafio consistiu em:
- Criar testes automatizados com **SuperTest e Mocha**;
- Implementar testes de performance com **k6**;
- Aplicar a **heur√≠stica VADER** para testes de API;
- Registrar evid√™ncias visuais e relat√≥rios dos testes executados.

---

## üß∞ Tecnologias Utilizadas

- **Node.js**
- **Express** ‚Äì API REST
- **Apollo Server** ‚Äì API GraphQL
- **GraphQL** ‚Äì Query language
- **Swagger** ‚Äì Documenta√ß√£o de endpoints REST
- **SuperTest** & **Mocha** ‚Äì Testes automatizados
- **k6** ‚Äì Testes de performance
- **Chai** ‚Äì Framework de assertions
- **Banco de dados em mem√≥ria**

---

## ‚öôÔ∏è Como Executar

1. **Clone o reposit√≥rio:**
```sh
git clone https://github.com/caiobberiba/transfer-users-api-testing.git
cd transfer-users-api-testing
```

2. **Instale as depend√™ncias:**
```sh
npm install
```

3. **Configure o arquivo `.env`:**
```env
BASE_URL_REST=http://localhost:3000
BASE_URL_GRAPHQL=http://localhost:4000/graphql
```

4. **Inicie os servidores:**

**API REST:**
```sh
npm run start-rest
# ou
node server.js
```

**API GraphQL:**
```sh
npm run start-graphql
# ou
node graphql/server.js
```

- **API REST** dispon√≠vel em: <http://localhost:3000>  
- **API GraphQL** dispon√≠vel em: <http://localhost:4000/graphql>
- **Documenta√ß√£o Swagger**: <http://localhost:3000/api-docs>

---

## üß™ Como Rodar os Testes

### üß≠ Testes Funcionais (SuperTest/Mocha)

**Total de testes implementados: 26 testes funcionais**

- **REST External**: 13 testes (6 usu√°rios + 7 transfer√™ncias)
- **REST Controller**: 5 testes (transfer√™ncias com mocks)
- **GraphQL External**: 4 testes (transfer√™ncias)
- **Testes VADER**: 4 testes focados em valida√ß√£o de dados (inclu√≠dos nos totais acima)

**Executar todos os testes funcionais:**
```sh
npm test
```

**Executar testes espec√≠ficos:**
```sh
# Testes REST
npm run test-rest-external
npm run test-rest-controller

# Testes GraphQL
npm run test-graphql-external
npm run test-graphql-controller
```

### ‚ö° Testes de Performance (k6)

**Executar todos os testes de performance:**
```sh
npm run test:performance
```

**Executar testes espec√≠ficos:**
```sh
# Testes individuais
npm run test:performance:register
npm run test:performance:login
npm run test:performance:get-users
npm run test:performance:create-transfer
npm run test:performance:get-transfers

# Teste combinado
npm run test:performance:combined

# Teste r√°pido (1 minuto)
npm run test:performance:quick
```

**Executar diretamente com k6:**
```sh
# Tornar o script execut√°vel
chmod +x performance/run-performance-tests.sh

# Executar todos os testes
./performance/run-performance-tests.sh all

# Executar teste espec√≠fico
./performance/run-performance-tests.sh register
./performance/run-performance-tests.sh combined
```

> **üìé Evid√™ncias:**  
> - [üìÑ Relat√≥rio de testes funcionais (functional_tests.pdf)](./docs/functional_tests.pdf)  
> - [üìÑ Relat√≥rio de performance (k6_report.pdf)](./docs/k6_report.pdf)

---

## üéØ Heur√≠stica VADER

Este projeto implementa a **heur√≠stica VADER** para testes de API, conforme descrito por [Maximiliano Alves](https://maximilianoalves.medium.com/vader-heuristica-para-teste-de-api-na-pratica-fcf78c6acec).

### üìã Componentes da Heur√≠stica

| Componente | Descri√ß√£o | Implementa√ß√£o no Projeto |
|------------|-----------|-------------------------|
| **V**erbs | Teste dos m√©todos HTTP | ‚úÖ GET, POST validados |
| **A**uthorization | Valida√ß√£o de autentica√ß√£o | ‚úÖ Bearer Token testado |
| **D**ata | Valida√ß√£o de dados | ‚úÖ **Foco principal** |
| **E**rrors | C√≥digos e mensagens de erro | ‚úÖ 400, 401, 404 testados |
| **R**esponsiveness | Tempo de resposta | ‚úÖ Testes de performance com k6 |

### üîç Implementa√ß√£o do Componente "D" (Data)

O foco principal foi na valida√ß√£o de **dados** conforme a heur√≠stica:

- **Tipagem**: Valida√ß√£o dos tipos do payload de envio e resposta
- **Formato**: Valida√ß√£o do Content-Type (`application/json`)
- **Tamanho**: Valida√ß√£o do tamanho do payload (< 2000 caracteres)
- **Estrutura**: Valida√ß√£o da presen√ßa e tipos dos campos obrigat√≥rios

**Testes VADER implementados:**
- `POST /users/login` - Valida√ß√£o de tipagem e tamanho
- `GET /users` - Valida√ß√£o de estrutura da resposta
- `POST /transfers` - Valida√ß√£o de dados da transfer√™ncia
- `GET /transfers` - Valida√ß√£o de array de transfer√™ncias

---

## üóÇÔ∏è Estrutura do Projeto

```text
.
‚îú‚îÄ‚îÄ app.js
‚îú‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ graphql/
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îú‚îÄ‚îÄ typeDefs.js
‚îÇ   ‚îú‚îÄ‚îÄ resolvers.js
‚îÇ   ‚îî‚îÄ‚îÄ authenticate.js
‚îú‚îÄ‚îÄ docs/                    
‚îÇ   ‚îú‚îÄ‚îÄ functional_tests.pdf          
‚îÇ   ‚îî‚îÄ‚îÄ k6_report.pdf    
‚îú‚îÄ‚îÄ controller/              
‚îú‚îÄ‚îÄ model/                   
‚îú‚îÄ‚îÄ service/                 
‚îú‚îÄ‚îÄ middleware/              
‚îú‚îÄ‚îÄ performance/
‚îÇ   ‚îú‚îÄ‚îÄ k6-performance-test.js
‚îÇ   ‚îú‚îÄ‚îÄ test-user-register.js
‚îÇ   ‚îú‚îÄ‚îÄ test-user-login.js
‚îÇ   ‚îú‚îÄ‚îÄ test-get-users.js
‚îÇ   ‚îú‚îÄ‚îÄ test-create-transfer.js
‚îÇ   ‚îú‚îÄ‚îÄ test-get-transfers.js
‚îÇ   ‚îî‚îÄ‚îÄ run-performance-tests.sh
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ rest/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/      
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ external/        
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fixture/         
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ requisicoes/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ transferencias/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ respostas/
‚îÇ   ‚îî‚îÄ‚îÄ graphql/
‚îÇ       ‚îú‚îÄ‚îÄ external/
‚îÇ       ‚îî‚îÄ‚îÄ fixture/
‚îÇ           ‚îú‚îÄ‚îÄ requisicoes/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ transferencia/
‚îÇ           ‚îî‚îÄ‚îÄ respostas/
‚îÇ               ‚îî‚îÄ‚îÄ transferencia/
‚îî‚îÄ‚îÄ ...
```

- **controller/** ‚Üí L√≥gica dos endpoints REST  
- **service/** ‚Üí Regras de neg√≥cio  
- **graphql/** ‚Üí API GraphQL com Apollo Server
- **performance/** ‚Üí Testes de performance com k6
- **test/** ‚Üí Testes automatizados (REST e GraphQL)  

---

## üìã Regras de Neg√≥cio

- N√£o √© permitido registrar usu√°rios duplicados;  
- Login exige **usu√°rio e senha**;  
- Transfer√™ncias acima de **R$ 5.000,00** s√≥ podem ser feitas para favorecidos;  
- O saldo inicial de cada usu√°rio √© de **R$ 10.000,00**.

---

## üöÄ Testes de Performance

### üìã Pr√©-requisitos

1. **k6 instalado**: Instale o k6 seguindo as instru√ß√µes em [https://k6.io/docs/getting-started/installation/](https://k6.io/docs/getting-started/installation/)

2. **Servidor rodando**: Certifique-se de que a API REST est√° rodando na porta 3000:
   ```bash
   npm run start-rest
   ```

### üéØ Cen√°rios de Teste

| Endpoint | Cen√°rio | Dura√ß√£o | Threshold |
|----------|---------|---------|-----------|
| `POST /users/register` | 5-10 usu√°rios simult√¢neos | ~6 minutos | 95% < 1.5s |
| `POST /users/login` | 10-20 usu√°rios simult√¢neos | ~6 minutos | 95% < 1s |
| `GET /users` | 15-30 usu√°rios simult√¢neos | ~6 minutos | 95% < 500ms |
| `POST /transfers` | 5-10 usu√°rios simult√¢neos | ~6 minutos | 95% < 2s |
| `GET /transfers` | 10-20 usu√°rios simult√¢neos | ~6 minutos | 95% < 1s |

### üìä M√©tricas Coletadas

- **http_req_duration**: Tempo de resposta das requisi√ß√µes
- **http_req_failed**: Taxa de falhas
- **M√©tricas customizadas**: Taxa de sucesso espec√≠fica para cada endpoint

### üîß Configura√ß√£o Avan√ßada

Para ajustar os cen√°rios de teste, edite a se√ß√£o `options` em cada arquivo de performance:

```javascript
export const options = {
  stages: [
    { duration: '30s', target: 10 }, // Ramp up
    { duration: '2m', target: 10 },  // Sustenta√ß√£o
    { duration: '30s', target: 0 },   // Ramp down
  ],
  thresholds: {
    http_req_duration: ['p(95)<1000'], // Ajustar limite de tempo
    http_req_failed: ['rate<0.05'],    // Ajustar taxa de erro
  },
};
```

### üêõ Troubleshooting

**Problemas Comuns:**
1. **Servidor n√£o responde**: Verificar se `npm run start-rest` est√° rodando
2. **Falhas de autentica√ß√£o**: Verificar se os usu√°rios de teste existem
3. **Timeout nas requisi√ß√µes**: Aumentar o timeout no k6 ou verificar performance do servidor

---

## üìä Resultados dos Testes

### üß™ Testes Funcionais
**26 testes executados com 100% de sucesso**

- **REST External**: 13 testes (6 usu√°rios + 7 transfer√™ncias)
- **REST Controller**: 5 testes (transfer√™ncias com mocks)
- **GraphQL External**: 4 testes (transfer√™ncias)
- **Testes VADER**: 4 testes focados em valida√ß√£o de dados (inclu√≠dos nos totais acima)

#### üìä Distribui√ß√£o dos Testes VADER

| Endpoint | Tipo de Valida√ß√£o | Testes Implementados |
|----------|-------------------|---------------------|
| `POST /users/login` | Tipagem, Formato, Tamanho | 1 teste |
| `GET /users` | Estrutura, Tipagem, Tamanho | 1 teste |
| `POST /transfers` | Tipagem, Formato, Tamanho | 1 teste |
| `GET /transfers` | Estrutura, Tipagem, Tamanho | 1 teste |
| **Total VADER** | **Valida√ß√£o de Dados** | **4 testes** |

### ‚ö° Testes de Performance
**6 cen√°rios de carga testados com k6**

- **POST /users/register**: 5-10 usu√°rios simult√¢neos
- **POST /users/login**: 10-20 usu√°rios simult√¢neos
- **GET /users**: 15-30 usu√°rios simult√¢neos
- **POST /transfers**: 5-10 usu√°rios simult√¢neos
- **GET /transfers**: 10-20 usu√°rios simult√¢neos
- **Teste combinado**: Todos os endpoints em sequ√™ncia

---

## üìë Relat√≥rios e Evid√™ncias

| Tipo de Teste | Descri√ß√£o | Arquivo |
|----------------|------------|----------|
| üß© **Funcionais (SuperTest/Mocha)** | Casos de teste REST automatizados, cobrindo autentica√ß√£o, listagem e transfer√™ncias | [Abrir relat√≥rio funcional (PDF)](./docs/functional_tests.pdf) |
| ‚öôÔ∏è **Performance (k6)** | Carga simulada com 50 VUs e picos de 100, medindo tempo m√©dio de resposta e throughput | [Abrir relat√≥rio de performance (PDF)](./docs/k6_report.pdf) |

---

## üìà M√©tricas de Cobertura e Performance

### üß™ Testes Funcionais

| M√©trica | Resultado | Ferramenta |
|----------|------------|-------------|
| ‚úÖ **Cobertura de endpoints REST** | 100% (6 de 6 endpoints) | SuperTest + Mocha |
| ‚úÖ **Cobertura de endpoints GraphQL** | 100% (queries e mutations) | SuperTest + Mocha |
| üß™ **Casos de teste executados** | 26 casos / 26 aprovados | Mocha |
| üéØ **Testes VADER implementados** | 4 dos 26 testes focados em dados | SuperTest + Mocha |
| ‚è±Ô∏è **Tempo total de execu√ß√£o (funcionais)** | ~0.77s | Mocha |
| üìä **Relat√≥rios gerados** | Mochawesome HTML/JSON | Mochawesome |

### ‚ö° Testes de Performance

| M√©trica | Resultado | Ferramenta |
|----------|------------|-------------|
| ‚ö° **Tempo m√©dio de resposta (k6)** | 230ms | k6 |
| üìâ **Erro m√°ximo sob carga (20 VUs)** | 0.00% | k6 |
| üìä **Throughput m√°ximo atingido** | 142 req/s | k6 |
| üéØ **Thresholds atendidos** | 95% das requisi√ß√µes < 2s | k6 |
| üîÑ **Cen√°rios de carga testados** | 6 cen√°rios (5 individuais + 1 combinado) | k6 |

### üöÄ APIs Dispon√≠veis

| API | Porta | Endpoint | Status |
|-----|-------|----------|--------|
| **REST** | 3000 | http://localhost:3000 | ‚úÖ Ativo |
| **GraphQL** | 4000 | http://localhost:4000/graphql | ‚úÖ Ativo |
| **Swagger** | 3000 | http://localhost:3000/api-docs | ‚úÖ Ativo |

> *Os resultados acima s√£o baseados na execu√ß√£o local dos testes sob ambiente Node 18.17.0.*

---

## ü™™ Cr√©ditos e Licen√ßa

<p align="center">
  <b>üë• Grupo 8:</b><br>
  <a href="https://github.com/brunockutzke">Bruno Kutzke</a> ¬∑ 
  <a href="https://github.com/caiobberiba">Caio B√™rib√°</a> ¬∑ 
  <a href="https://github.com/dennyscaetano">Dennys Matos</a> ¬∑ 
  <a href="https://github.com/jorgemobil">Jorge Antonio</a> ¬∑ 
  <a href="https://github.com/simonegabionetta">Simone Gabionetta</a><br>
  <i>Desafio #3 ‚Äì Mentoria 2.0 em Testes de Software</i><br><br>
  Licen√ßa: mesma do projeto original de <a href="https://github.com/juliodelimas/pgats-02-api">J√∫lio de Lima</a>.
</p>

---

<p align="center">
  <b>‚≠ê Desenvolvido com foco em qualidade, automa√ß√£o e performance.</b><br>
  <a href="https://github.com/caiobberiba/transfer-users-api-testing">github.com/caiobberiba/transfer-users-api-testing</a>
</p>
